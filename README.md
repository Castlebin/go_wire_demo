# Golang依赖注入框架wire使用详解
https://zhuanlan.zhihu.com/p/338926709

## 1. 初始化项目
```shell
mkdir go_wire_demo
cd go_wire_demo
go mod init go_wire_demo
```

### 1.1. 安装 wire 命令行工具
```shell
# 安装命令 （注意，将 GOPATH/bin 加入 PATH）
go install github.com/google/wire/cmd/wire
```

### 1.2. 项目安装依赖
```shell
go get -u github.com/google/wire
```

## 2. Quick Start
### 2.1. 新建 main.go 文件
```go
package main

import "fmt"

type Message struct {
	msg string
}
type Greeter struct {
	Message Message
}
type Event struct {
	Greeter Greeter
}

// NewMessage Message的构造函数
func NewMessage(msg string) Message {
	return Message{
		msg: msg,
	}
}

// NewGreeter Greeter构造函数
func NewGreeter(m Message) Greeter {
	return Greeter{Message: m}
}

// NewEvent Event构造函数
func NewEvent(g Greeter) Event {
	return Event{Greeter: g}
}

func (e Event) Start() {
	msg := e.Greeter.Greet()
	fmt.Println(msg)
}

func (g Greeter) Greet() Message {
	return g.Message
}

/**
项目需要 3 个对象，对象关系如下：
Event (
	Greeter : Greeter (
		Message : Message (
			msg : string
		)
	)
)
*/

// 使用wire前
func main() {
	message := NewMessage("hello world")
	greeter := NewGreeter(message)
	event := NewEvent(greeter)

	event.Start()
}
```

### 2.2. 编写 wire.go 文件
wire.go 文件是 wire 的配置文件，用于告诉 wire 如何构建对象。
```go
//go:build wireinject
// +build wireinject

// The build tag makes sure the stub is not built in the final build.

package main

import "github.com/google/wire"

// InitializeEvent 声明 injector 的函数签名
func InitializeEvent(msg string) Event {
	wire.Build(NewEvent, NewGreeter, NewMessage)
	return Event{} //返回值没有实际意义，只需符合函数签名即可
}
```

调用wire命令生成依赖文件：
```shell
wire
```
发现目录下已经生成了 wire_gen.go 文件，内容如下：
```go
// Code generated by Wire. DO NOT EDIT.

//go:generate go run github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

// Injectors from wire.go:

// InitializeEvent 声明 injector 的函数签名
func InitializeEvent(msg string) Event {
	message := NewMessage(msg)
	greeter := NewGreeter(message)
	event := NewEvent(greeter)
	return event
}
```

现在可以修改 main.go 文件，使用 wire 生成的 InitializeEvent 函数来构建对象：
```go
// 使用wire后
func main() {
	event := InitializeEvent("hello_world")

	event.Start()
}
```

